## 企业IT架构转型之道：阿里巴巴中台战略思想与架构实战——读书笔记

作者：钟华

### 第一部分 引子

#### 烟囱式 有三大弊端：

> 1）重复功能建设和维护带来的重复投资。
> 2）打通“烟囱式”系统间交互的集成和协作成本高昂
> 3）不利于业务的沉淀和持续发展

#### SOA没起到预期作用

> 1）服务提供者团队不管是从KPI考核的角度，还是从认知上认为服务封装的任务已经完成，所以当他们收到新的服务需求时，心理上是拒绝的，会出于多一事不如少一事的心态，告诉新业务系统的需求方：“我们目前仅能提供这样的服务”
>
> 2）服务提供者团队拥有不错做事的态度，也愿意改造服务以满足新业务的需求，但受限于之前服务设计时的通用性和业务前瞻性的不足，造成如果要满足新业务的需求，就要对现有服务的数据模型、业务逻辑做较大的改造，在改造带来的风险和满足新业务需求的选择中，更多的团队选择了放弃对新业务需求的支持，而保持现有服务提供的稳定，其结果跟第一种情况完全一样。

#### 理解业务

> 但我所说的懂业务是指，能对业务的下一步发展有着自己的理解和看法，对业务流程如何进一步优化能更好地提升业务，甚至对企业现有的业务提出创新的想法，为企业带来新的业务增长点。

#### 不停的满足业务需求，技术方面没成长

>甚至同时负责多个项目，而这在我看来终归是增加了项目经验，并不能在某一专业领域得到知识和经验的沉淀，我相信随着时间的流逝，越来越多的人会慢慢失去最初的工作积极性和创造性

#### 构建业务中台的基础——共享服务体系

#### 专家的形成

>说到专家的形成，我认为其实跟大家从小到大的学习是一样的道理，我们从小学开始学习很多基础知识，更多是知识点的掌握；随着我们掌握知识点的增多，我们开始有意识地将一些知识点组合在一起，解决一些复杂的问题，关联这些知识点的过程实际上是将这些相关的知识点串成了知识线；随着在知识领域的继续积累，越来越多知

#### 企业实施大数据项目不达预期

>> 其中有以下两个问题尤为凸显：
>>
>> 数据分布广、格式不统一、不标准。
>> 缺少能基于数据有业务建模能力的专家。

共享服务需要：既精通业务，又熟悉技术”的复合型人才

###  第二部分 共享服务体系搭建

#### 共享服务体系搭建

> 1.分布式服务框架的选择：中心化与去中心化
> 2.共享服务中心建设原则
> 3.数据拆分实现数据库能力线性扩展
> 4.异步化与缓存原则
> 5.打造数字化运营能力
> 6.打造平台稳定性能力
> 7.共享服务中心对内和对外的写作共享

#### SOA的主要特性：

> ❑面向服务的分布式计算。
> ❑服务间松散耦合。
> ❑支持服务的组装。
> ❑服务注册和自动发现。
> ❑以服务契约方式定义服务交互方式。

ESB模式的“中心化”服务架构的根本诉求：实现异构系统之间的交互。

“去中心化”分布式服务架构解决的问题：扩展性

>一个互联网平台的业务发展得再好，一旦有更多的用户访问后，这个平台如果没法再进行扩展的话，这将给平台带来灾难性的后果。这就是为什么今天几乎所有互联网公司均基于“去中心化”分布式服务框架建设系统，其根本原因就在于扩展性是首要的。

#### 微服务架构的典型特征的描述：

> 分布式服务组成的系统
> 按照业务而不是技术来划分组织
> 做有生命的产品而不是项目
> 智能化服务端点与傻瓜式服务编排
> 自动化运维
> 系统容错
> 服务快速演化

从本质上来说：“微服务”是SOA的一种演变后的变形

#### 服务中心划分原则

> 1.高内聚，低耦合原则
> 2.数据完整性原则
> 3.业务可运营原则
> 4.渐进性建设原则

###  第5章 数据拆分实现数据库能力线性扩展

2014年，阿里巴巴已经研发出新一代分布式数据库产品DRDS（Distributed Relational Database Service）

淘宝的订单数据就是在异构索引表中全复制的，即订单按照买家ID维度进行分库分表的订单索引表跟以订单ID维度进行分库分表的订单表中的字段完全一样，这样确实避免了多一次的数据库访问

所以我们还是建议采用仅仅做异构索引表，而不是数据全复制，同时采用两次SQL请求的方式解决出现全表扫描的问题。

如果在“尽量减小事务边界”与“数据尽可能平均拆分”两个原则间发生了冲突，那么请选择“数据尽可能平均拆分”作为优先考虑原则，因为事务边界的问题相对来说更好解决，无论是做全表扫描或做异构索引复制都是可以解决的。

在实际中，我们仅针对那些在80%情况下访问的那20%的场景进行如数据异构索引这样的处理，达到这类场景的性能最优化

#### 第6章 异步化与缓存原则

当然，在此过程中，一定要考虑到程序异常时对业务的回滚或重试机制，保障整个还款过程结果的最终一致。

所以在分布式领域，基于CAP理论和在其基础上延伸出的BASE理论，有人提出了“柔性事务”的概念。

CAP理论：一个分布式系统最多只能同时满足一致性，可用性，和分区容错性这三项中的两项：

> 一致性”指更新操作成功并返回客户端完成后，所有节点在同一时间的数据完全一致。
>
> “可用性”指用户在访问数据时可以得到及时的响应
>
> “分区容错性”指分布式系统在遇到某节点或网络分区故障的时候，仍然能够对外提供满足一致性和可用性的服务

#### 柔性事务在阿里巴巴内部的几种实现：

>（1）消息分布式事务
>（2）支付宝XTS框架：XTS可同时支持正向和反向补偿。
>
>> 总结。本质上支付宝的XTS给开发人员提供了一个实现分布式事务的事务框架，主要负责事务日志的记录，事务的参与者需要实现XTS提供的接口，以实现XTS框架对事务参与者的事务协调和控制。

阿里巴巴AliWare TXC事务服务

>TXC架构概览。TXC同样也是基于两阶段提交的理论实现的分布式事务框架，全面支持分布式数据库事务、多库事务、消息事务、服务链路调用事务及其各种组合场景下的事务，
>
>TXC Server扮演了事务协调者的角色，负责对整个事务上下文的日志的记录以及在事务处理过程中全局的协调和控制。

#### 第7章 打造数字化运营能力

>在当前的业务流程设计中，我依赖了哪些应用、哪些服务？❑整个链路的依赖路径是怎样的？哪些服务对当前业务处理来说是最为核心的？这些依赖如果出错，会有什么影响？❑一次业务请求处理的时间到底花在了什么地方？是因为某一个服务耗时很长，还是某一个数据库的访问操作耗时最久，需要有一个清晰直观的定位。❑我所负责的业务链路中，过去一段时间哪些服务是出错率比较高的，哪些服务是业务链路的处理瓶颈？

#### 第8章 打造平台稳定性能力

>所以在实际中，都会通过服务的QPS作为限流的关键判断指标。

>对于实现服务的限流控制，传统的实现方式通常使用Spring的AOP机制，对需要限流的接口定义一个advice拦截器，

>Sentinel平台正如它英文的意思“哨兵”一样，为整个服务化体系的稳定运行行使着警戒任务，是对资源调用的控制平台，主要涵盖了授权、限流、降级、调用统计监控四大功能模块

>阿里巴巴中间件团队实现了针对分布式服务系统的流量调度平台，用于屏蔽所有机器的软硬件差异，根据机器的实时服务能力来分配机器的实时流量。对实时服务能力好的机器多分配流量；对实时服务能力差的机器减少流量分配；对实时服务能力不可用的机器迁移流量。

>流量调度的核心是通过秒级获取服务器系统运行指标以及业务指标，通过流量调度平台设置的决策算法以及规则，当发现满足规则条件的指标状态发生时，对线上环境的服务器进行下线等操作，以屏蔽这些单点或局部出现故障的应用实例对整体平台产生扩展式的影响

#### 第9章 共享服务中心对内和对外的协作共享

>这和传统商业软件有巨大的反差，商业软件发版有严格的市场策略和规划，他们要用市场来收回成本赚取利润；而互联网模式使用新特性来吸引用户，只要用户在，赚钱永远不是问题

>业务中台除了提供对前端应用的高效支持，同时也承载了业务持续沉淀和创新的使命。

### 扩展
#### 中台的具体划分
业务中台、技术中台、数据中台、算法中台

#### 中台的适用场景 

> 从0到1的阶段，没有必要搭建中台。
>
> > 从0到1的创业型公司，首要目的是生存下去，以最快的速度打造出产品，证明自身的市场价值。这个时候，让项目野蛮生长才是最好的选择。如果不慌不忙地先去搭建中台，恐怕中台还没搭建好，公司早就饿死了。
>
> 从1到N的阶段，适合搭建中台。
>
> > 当企业有了一定规模，产品得到了市场的认可，这时候公司的首要目的不再是活下去，而是活的更好。这个时候，趁着项目复杂度还不是特别高，可以考虑把各项目的通用部分下沉，组建中台，以方便后续新项目的尝试和旧项目的迭代。
>
> 从N到N+1的阶段，搭建中台势在必行。
>
> > 当企业已经有了很大的规模，各种产品、服务、部门错综复杂，这时候做架构调整会比较痛苦。但是长痛不如短痛，为了项目的长期发展，还是需要尽早调整架构，实现平台化，以免日后越来越难以维护。


